<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        #taskInput {
            width: 200px;
        }

        #priceInput {
            width: 80px;
        }

        #taskList {
            list-style: none;
            padding: 0;
        }

        .taskItem {
            margin-bottom: 10px;
        }

        .price {
            margin-left: 10px;
            color: #555;
        }
    </style>
    <title>Запланована робота</title>
</head>
<body>

<h1>Запланована робота</h1>

<label for="taskInput">Запланована робота: </label>
<input type="text" id="taskInput" placeholder="Введіть роботу">

<label for="priceInput">Ціна: </label>
<input type="number" id="priceInput" placeholder="Введіть ціну">

<button onclick="addTask()">Додати</button>

<ul id="taskList"></ul>

<script>
    var db;

    // Відкриття або створення бази даних
    var request = window.indexedDB.open('tasksDB', 1);

    request.onerror = function(event) {
        console.log('Помилка відкриття бази даних:', event.target.errorCode);
    };

    request.onsuccess = function(event) {
        console.log('База даних відкрита успішно');
        db = event.target.result;

        // Завантаження робіт при завантаженні сторінки
        loadTasks();
    };

    request.onupgradeneeded = function(event) {
        console.log('Оновлення бази даних');
        var db = event.target.result;

        // Створення об'єктного сховища для робіт
        var objectStore = db.createObjectStore('tasks', { keyPath: 'id', autoIncrement: true });

        // Додавання індексів для полів
        objectStore.createIndex('text', 'text', { unique: false });
        objectStore.createIndex('price', 'price', { unique: false });
    };

    function addTask() {
        var taskInput = document.getElementById('taskInput');
        var priceInput = document.getElementById('priceInput');

        if (taskInput.value.trim() !== '') {
            var transaction = db.transaction(['tasks'], 'readwrite');
            var objectStore = transaction.objectStore('tasks');

            // Додавання роботи до бази даних
            var request = objectStore.add({ text: taskInput.value, price: priceInput.value });

            request.onsuccess = function(event) {
                console.log('Робота додана до бази даних');
                taskInput.value = '';
                priceInput.value = '';

                // Оновлення відображення робіт
                loadTasks();
            };

            request.onerror = function(event) {
                console.log('Помилка додавання роботи:', event.target.errorCode);
            };
        }
    }

    function loadTasks() {
        var taskList = document.getElementById('taskList');

        // Очищення відображення робіт
        taskList.innerHTML = '';

        var transaction = db.transaction(['tasks'], 'readonly');
        var objectStore = transaction.objectStore('tasks');

        // Відкриття курсора для прочитання всіх робіт
        var request = objectStore.openCursor();

        request.onsuccess = function(event) {
            var cursor = event.target.result;

            if (cursor) {
                // Створення елемента списку для кожної роботи
                var taskItem = document.createElement('li');
                taskItem.className = 'taskItem';

                var taskText = document.createElement('span');
                taskText.textContent = cursor.value.text;

                var taskPrice = document.createElement('span');
                taskPrice.className = 'price';
                taskPrice.textContent = 'Ціна: ' + cursor.value.price;

                taskItem.appendChild(taskText);
                taskItem.appendChild(taskPrice);

                taskList.appendChild(taskItem);

                // Переход до наступного запису в базі даних
                cursor.continue();
            }
        };
    }
</script>

</body>
</html>
